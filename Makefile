#-------------------------------------------------------------------------------
.SUFFIXES:
#-------------------------------------------------------------------------------
ifeq ($(strip $(DEVKITARM)),)
$(error "Set DEVKITARM in your environment.")
endif

include $(DEVKITARM)/ds_rules

export TARGET		:=	$(shell basename $(CURDIR))
export TOPDIR		:=	$(CURDIR)
export PATH			:=	$(DEVKITARM)/bin:$(PATH)

#-------------------------------------------------------------------------------
# path to tools
#-------------------------------------------------------------------------------

#-------------------------------------------------------------------------------
# Platform overrides.
#-------------------------------------------------------------------------------
##include Makefile.$(shell uname)

.PHONY: checkarm7 checkarm9 clean

#---------------------------------------------------------------------------------
# main targets
#---------------------------------------------------------------------------------
all: checkarm7 checkarm9 $(TARGET).nds

#---------------------------------------------------------------------------------
checkarm7:
	$(MAKE) -C arm7

#---------------------------------------------------------------------------------
checkarm9:
	$(MAKE) -C arm9

#-------------------------------------------------------------------------------
$(TARGET).nds		: arm7/$(TARGET).elf arm9/$(TARGET).elf
	ndstool -b data/icon.bmp \
	"IkuReader;an ebook reader; " \
	-c sandbox/$(TARGET).nds -7 arm7/arm7.elf -9 arm9/arm9.elf

#-------------------------------------------------------------------------------
#(TARGET).arm7		: arm7/$(TARGET).elf
#$(TARGET).arm9		: arm9/$(TARGET).elf

#-------------------------------------------------------------------------------
arm7/$(TARGET).elf:
	$(MAKE) -C arm7

#-------------------------------------------------------------------------------
arm9/$(TARGET).elf:
	$(MAKE) -C arm9

#-------------------------------------------------------------------------------
clean:
	$(MAKE) -C arm9 clean
	$(MAKE) -C arm7 clean
	rm -f sandbox/$(TARGET).nds